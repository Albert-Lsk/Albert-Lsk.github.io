<!-- 防止主题切换闪烁 - 必须内联到head中 -->
<script>
(function() {
  'use strict';
  
  const STORAGE_KEY = 'theme-preference';
  const ATTRIBUTE = 'data-theme';
  
  // 获取保存的主题偏好
  const savedTheme = localStorage.getItem(STORAGE_KEY);
  
  // 检测系统主题偏好
  const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const systemTheme = systemDark ? 'dark' : 'light';
  
  // 基于时间的主题建议
  const hour = new Date().getHours();
  const timeBasedTheme = (hour >= 6 && hour < 18) ? 'light' : 'dark';
  
  // 主题优先级：保存的主题 > 系统主题 > 时间主题 > 默认(light)
  const theme = savedTheme || systemTheme || timeBasedTheme || 'light';
  
  // 立即应用主题，避免闪烁
  document.documentElement.setAttribute(ATTRIBUTE, theme);
})();
</script>

<!-- 主题切换系统 -->
<script src="{{ '/assets/js/theme-toggle.js' | relative_url }}" defer></script>

<!-- 优化字体加载 -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">

<!-- 性能优化 -->
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//fonts.gstatic.com">
